<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
<!-- Google Analytics Control Script -->
<script>
  (function() {
    var GA_ID = 'G-TS77Z86Q2V';

    var isLocal = window.location.hostname === 'localhost' || 
                  window.location.hostname === '127.0.0.1' || 
                  window.location.hostname.startsWith('192.168.') ||
                  window.location.protocol === 'file:';

    var isAdmin = localStorage.getItem('analytics_ignore') === 'true';

    if (!isLocal && !isAdmin) {
      var script = document.createElement('script');
      script.async = true;
      script.src = 'https://www.googletagmanager.com/gtag/js?id=' + GA_ID;
      document.head.appendChild(script);

      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', GA_ID);
    } else {
      console.log('Google Analytics blocked (Local or Admin)');
    }
  })();
</script>
    <title>視聴者参加型：みんなでゲーム</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <style>
        .game-selection {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 30px;
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
            padding-bottom: 40px;
        }
        
        #home-page {
            overflow-y: auto;
            min-height: calc(100vh - 100px);
            align-items: flex-start;
            padding-top: 40px;
        }
    </style>
</head>
<body>

    <div id="mobile-warning-overlay">
        <div class="mobile-warning-content">
            <h1>PCでのご利用を推奨します</h1>
            <p>
                このサイトのゲームは、PCの大きな画面でのプレイを想定して作られています。<br>
                スマートフォンでは、レイアウトが崩れたり、正しく操作できない可能性があります。
            </p>
            <button id="mobile-warning-close-btn">閉じて続ける</button>
        </div>
    </div>

    <header class="site-header">
        <h1>視聴者参加型：みんなでゲーム</h1>
        <nav>
            <a href="index.html">ホーム</a>
            <a href="help.html">よくある質問</a>
            <a href="about.html">このサイトについて</a>
            <button id="api-settings-btn" class="header-api-btn">
                <span class="icon">⚙️</span> 配信者用設定
            </button>
        </nav>
    </header>

    <main id="home-page">
        <div class="game-selection">
            <!-- ゲームカード1: 高校野球シミュレーション -->
            <div class="game-card">
                <h2>高校野球シミュレーション</h2>
                <img src="baseball/img/p_normal.png" alt="高校野球シミュレーション サムネイル" class="game-thumbnail">
                <p>高校球児として3年間を過ごし、甲子園を目指そう！</p>
                <div class="mode-buttons">
                    <a href="baseball/index.html?mode=solo" class="game-link-btn btn-green">個人で遊ぶ</a>
                    <a href="baseball/index.html?mode=streamer" class="game-link-btn btn-blue">配信で遊ぶ</a>
                    
                    <button id="home-how-to-play-btn" class="game-link-btn btn-gray">遊び方・機能説明</button>
                    <button id="home-support-btn" class="game-link-btn btn-pink">開発者を支援する</button>
                </div>
            </div>
            
            <!-- ゲームカード2: 視聴者参加型世論調査 -->
            <div class="game-card">
                <h2>視聴者参加型世論調査</h2>
                <img src="war/thumbnail.png" alt="陣取り合戦 サムネイル" class="game-thumbnail">
                <p>コメント数で勢力を拡大せよ！<br>視聴者参加型の陣取りゲーム。</p>
                <div class="mode-buttons">
                    <a href="war/index.html?mode=demo" class="game-link-btn btn-green">デモプレイ（個人）</a>
                    <a href="war/index.html?mode=stream" class="game-link-btn btn-blue">配信で遊ぶ</a>
                    
                    <button id="war-how-to-play-btn" class="game-link-btn btn-gray">遊び方・機能説明</button>
                    <button id="war-support-btn" class="game-link-btn btn-pink">開発者を支援する</button>
                </div>
            </div>
            
            <!-- ゲームカード3: クイズ・ミリオネア -->
            <div class="game-card">
                <h2>クイズ・ミリオネア</h2>
                <div class="thumbnail-placeholder" style="border-color: #f6ad55; color: #f6ad55;">
                    <span style="font-size: 2em;">Q</span>
                </div>
                <p>全問正解を目指せ！<br>視聴者の投票で答えを決めるクイズ番組。</p>
                <div class="mode-buttons">
                    <a href="quiz/index.html?mode=solo" class="game-link-btn btn-green">個人で遊ぶ</a>
                    <a href="quiz/index.html?mode=streamer" class="game-link-btn btn-blue">配信で遊ぶ</a>
                    
                    <button id="quiz-how-to-play-btn" class="game-link-btn btn-gray">遊び方・機能説明</button>
                    <button id="quiz-support-btn" class="game-link-btn btn-pink">開発者を支援する</button>
                </div>
            </div>

            <!-- ゲームカード4: 難読漢字クイズ -->
            <div class="game-card">
                <h2>難読漢字クイズ</h2>
                <div class="thumbnail-placeholder" style="border-color: #e53e3e; color: #e53e3e;">
                    <span style="font-size: 2em;">漢</span>
                </div>
                <p>読めたら天才！？<br>視聴者と一緒に難読漢字に挑戦しよう。</p>
                <div class="mode-buttons">
                    <a href="kanji/index.html?mode=solo" class="game-link-btn btn-green">個人で遊ぶ</a>
                    <a href="kanji/index.html?mode=streamer" class="game-link-btn btn-blue">配信で遊ぶ</a>
                    
                    <button id="kanji-how-to-play-btn" class="game-link-btn btn-gray">遊び方・機能説明</button>
                    <button id="kanji-support-btn" class="game-link-btn btn-pink">開発者を支援する</button>
                </div>
            </div>

            <!-- ゲームカード5: The Secret Site -->
            <div class="game-card">
                <h2>The Secret Site</h2>
                <div class="thumbnail-placeholder" style="border-color: #000; color: #fff; background: #222;">
                    <span style="font-size: 2em; font-family: 'Courier New', monospace;">404</span>
                </div>
                <p>深夜2時、そのサイトは現れる。<br>都市伝説の謎を解き明かせ。</p>
                <div class="mode-buttons">
                    <a href="mystery/index.html" class="game-link-btn btn-purple" style="background-color: #6b46c1;">PLAY START</a>
                    <button id="mystery-how-to-play-btn" class="game-link-btn btn-gray">遊び方・機能説明</button>
                    <button id="mystery-support-btn" class="game-link-btn btn-pink">開発者を支援する</button>
                </div>
            </div>
            
            <!-- ゲームカード6: Connect Territory -->
            <div class="game-card">
                <h2>Connect Territory</h2>
                <div class="thumbnail-placeholder" style="border-color: #4299e1; color: #4299e1;">
                    <span style="font-size: 2em;">🌐</span>
                </div>
                <p>コメントでマスを塗って陣地を広げろ！<br>視聴者参加型のリアルタイム陣取り合戦。</p>
                <div class="mode-buttons">
                    <a href="territory/index.html?mode=demo" class="game-link-btn btn-green">個人で遊ぶ（デモプレイ）</a>
                    <a href="territory/index.html?mode=stream" class="game-link-btn btn-blue">配信で遊ぶ</a>
                    <button id="territory-how-to-play-btn" class="game-link-btn btn-gray">遊び方・機能説明</button>
                    <button id="territory-support-btn" class="game-link-btn btn-pink">開発者を支援する</button>
                </div>
            </div>

            <!-- ゲームカード: Streamer Pixel Art -->
            <div class="game-card">
                <h2>Streamer Pixel Art</h2>
                <div class="thumbnail-placeholder" style="border-color: #ff7675; color: #ff7675;">
                    <span style="font-size: 2em;">🎨</span>
                </div>
                <p>みんなで一つの絵を描こう！<br>協力してキャンバスを彩るお絵描きゲーム。</p>
                <div class="mode-buttons">
                    <a href="pixel/index.html?mode=solo" class="game-link-btn btn-green">個人で遊ぶ</a>
                    <a href="pixel/index.html?mode=stream" class="game-link-btn btn-blue">配信で遊ぶ</a>
                    <button id="pixel-how-to-play-btn" class="game-link-btn btn-gray">遊び方</button>
                    <button class="game-link-btn btn-pink" onclick="document.getElementById('home-support-modal').style.display = 'flex'">開発者を支援する</button>
                </div>
            </div>

            <!-- ゲームカード7: Coming Soon -->
            <div class="game-card">
                <h2>Coming Soon</h2>
                <div class="thumbnail-placeholder" style="border-color: #718096; color: #718096; border-style: dashed;">
                    <span style="font-size: 2em;">?</span>
                </div>
                <p>新しいゲームを準備中です。<br>次回アップデートをお楽しみに！</p>
                <div class="mode-buttons">
                    <button class="game-link-btn btn-gray" disabled style="cursor: default; opacity: 0.6;">制作中</button>
                </div>
            </div>

        </div>
    </main>

    <!-- ▼▼▼ 配信設定モーダル ▼▼▼ -->
    <div id="global-api-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <h2>配信設定（API & Video ID）</h2>
            <div class="warning-box" style="border-color: #ecc94b; background-color: rgba(236, 201, 75, 0.15);">
                <h3 style="color: #ecc94b;">⚠️ 配信遅延設定について</h3>
                <p style="font-size: 0.9em; font-weight: normal;">
                    ゲームを快適に遊ぶため、YouTube Liveの管理画面で<br>
                    <strong>「超低遅延 (Ultra Low Latency)」</strong>に設定することを<br>
                    <span style="color: #ecc94b; font-weight: bold; text-decoration: underline;">強く推奨</span>します。<br>
                    <span style="font-size: 0.8em; color: #a0aec0;">※「通常」や「低遅延」だと、投票が間に合わない可能性があります。</span>
                </p>
            </div>
            <div class="warning-box">
                <h3>⚠️ 配信者の皆様へ</h3>
                <p>
                    ここにキーを入力する際はGoogle Cloud Console画面を含め、<br>
                    <strong>必ず配信画面から隠す（待機画面にする）などして、</strong><br>
                    <strong>視聴者にキーが見られないようにしてください。</strong>
                </p>
            </div>
            <p class="modal-desc">
                ここで設定した内容はブラウザに一時保存され、<br>
                各ゲームの配信モードで自動的に適用されます。<br>
                <small>※ブラウザを閉じるとリセットされます。</small>
            </p>
            <div class="input-group">
                <label>YouTube API Key</label>
                <input type="password" id="global-api-key" placeholder="APIキーを入力" autocomplete="off">
            </div>
            <div class="input-group">
                <label>Video ID (または配信URL)</label>
                <input type="text" id="global-video-id" placeholder="例: jNQXAC9IVRw または URL" autocomplete="off">
                <p style="font-size: 0.8em; color: #a0aec0; margin-top: 5px;">
                    ※URLを入力した場合、自動でID部分を抽出します。
                </p>
            </div>
            <div style="text-align: left; margin-top: 15px;">
                <button id="toggle-help-btn" class="btn-gray" style="width: 100%; font-size: 0.9em; padding: 8px;">
                    💡 キーの取得方法を見る
                </button>
                <div id="api-help-content" style="display: none; background: #222; padding: 15px; border-radius: 5px; margin-top: 10px; font-size: 0.85em; color: #ddd; line-height: 1.6;">
                    <strong>🔑 YouTube API Key の取得方法:</strong>
                    <ol style="padding-left: 20px; margin: 5px 0;">
                        <li><a href="https://console.cloud.google.com/" target="_blank" style="color:#63b3ed;">Google Cloud Console</a> にアクセス</li>
                        <li>新しいプロジェクトを作成</li>
                        <li>「APIとサービス」>「ライブラリ」で「YouTube Data API v3」を有効化</li>
                        <li>「認証情報」>「認証情報を作成」>「APIキー」を選択</li>
                    </ol>
                    <br>
                    <strong>📺 Video ID の取得方法:</strong>
                    <ul style="padding-left: 20px; margin: 5px 0;">
                        <li>配信枠のURLの末尾（v=の後ろ）の文字列です。</li>
                        <li>例: youtube.com/watch?v=<strong>XXXXXXXXXXX</strong></li>
                        <li>※上の欄にURLをそのまま貼り付けてもOKです。</li>
                    </ul>
                </div>
            </div>
            <div class="modal-buttons">
                <button id="save-api-btn" class="btn-green">設定を保存して閉じる</button>
                <button id="close-api-btn" class="btn-gray">閉じる</button>
            </div>
        </div>
    </div>

    <!-- ▼▼▼ 遊び方モーダル群 ▼▼▼ -->
    
    <!-- 野球ゲーム用 -->
    <div id="home-help-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content help-content">
            <h2>ゲームの遊び方</h2>
            <div class="help-scroll-area">
                <h3>⚾ ゲームの目的</h3>
                <p>高校球児として3年間練習に励み、甲子園優勝とプロ入り（ドラフト指名）を目指す育成シミュレーションゲームです。</p>
                <h3>🎮 基本的な流れ</h3>
                <ul>
                    <li><strong>コマンド選択:</strong> 「筋トレ」「練習」などを選び、能力を上げます。</li>
                    <li><strong>イベント:</strong> 季節ごとのイベントや、ランダムイベントが発生します。</li>
                    <li><strong>試合:</strong> 自動試合ですが、チャンスの場面では操作が必要になります。</li>
                </ul>
                <h3>📡 配信者モードについて</h3>
                <p>YouTubeのライブチャットと連携し、視聴者のコメント投票で行動を決定できます。</p>
                <h3>🎵 素材提供・クレジット</h3>
                <p>本ゲームでは、以下の素晴らしい素材を使用させていただいております。</p>
                <ul>
                    <li><strong>BGM:</strong> MusMus<br><a href="https://musmus.main.jp/" target="_blank" style="color:#63b3ed;">https://musmus.main.jp/</a></li>
                    <li><strong>キャラクター画像:</strong> CHARAT (キャラット)<br><a href="https://charat.me/" target="_blank" style="color:#63b3ed;">https://charat.me/</a></li>
                </ul>
            </div>
            <button id="close-home-help-btn" class="btn-gray" style="margin-top:20px;">閉じる</button>
        </div>
    </div>

    <!-- 世論調査ゲーム用 -->
    <div id="war-help-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content help-content">
            <h2>視聴者参加型世論調査の遊び方</h2>
            <div class="help-scroll-area">
                <h3>🚩 ゲームの目的</h3>
                <p>2つの派閥に分かれて日本全国の都道府県を奪い合うゲームです。制限時間内により多くの地域を支配したチームの勝利です。</p>
                <h3>💬 参加方法</h3>
                <p>YouTubeライブのコメント欄で<strong>「都道府県名 派閥名」</strong>とコメントすることで、その地域に戦力を送ることができます。</p>
                <p>例：「東京 A」「大阪 B」など</p>
                <h3>⚔️ イベント</h3>
                <p>ゲーム中、ランダムで「確変タイム」や「裏切り」などのイベントが発生し、戦況が大きく変わることがあります。</p>
            </div>
            <button id="close-war-help-btn" class="btn-gray" style="margin-top:20px;">閉じる</button>
        </div>
    </div>

    <!-- クイズゲーム用 -->
    <div id="quiz-help-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content help-content">
            <h2>クイズの遊び方</h2>
            <div class="help-scroll-area">
                <h3>💡 ゲームの目的</h3>
                <p>4択クイズに連続正解し、設定された目標（10問〜50問）のクリアを目指します。</p>
                <h3>🎮 配信者モード</h3>
                <p>YouTubeライブのコメント欄と連携し、視聴者がコメントした番号（「1」「2」など）を集計して、一番多い選択肢を回答とします。</p>
                <p>※多数決で進むため、一体感が生まれます！</p>
                <h3>❤️ ライフ制</h3>
                <p>間違えても大丈夫！設定したライフの回数だけ失敗できます。</p>
            </div>
            <button id="close-quiz-help-btn" class="btn-gray" style="margin-top:20px;">閉じる</button>
        </div>
    </div>

    <!-- 漢字ゲーム用 -->
    <div id="kanji-help-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content help-content">
            <h2>難読漢字クイズの遊び方</h2>
            <div class="help-scroll-area">
                <h3>💡 ゲームの目的</h3>
                <p>表示される難読漢字の正しい読み方を4択から選びます。</p>
                <h3>🎮 配信者モード</h3>
                <p>YouTubeライブのコメント欄と連携し、視聴者の投票で回答を決定します。</p>
                <h3>📚 レベル分け</h3>
                <p>初級（日常）から特級（漢検1級レベル）まで、幅広い難易度を用意しています。</p>
            </div>
            <button id="close-kanji-help-btn" class="btn-gray" style="margin-top:20px;">閉じる</button>
        </div>
    </div>

    <!-- ミステリーゲーム用 -->
    <div id="mystery-help-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content help-content">
            <h2>The Secret Site の遊び方</h2>
            <div class="help-scroll-area">
                <h3>🕵️ ゲームの目的</h3>
                <p>「深夜2時59分にだけ繋がる」と噂される都市伝説のサイトを調査し、隠された謎を解き明かす短編ホラーアドベンチャーです。</p>
                <h3>🎮 操作方法</h3>
                <ul>
                    <li>画面内の怪しい箇所をクリックしたり、キーボードでコマンドを入力して調査を進めます。</li>
                    <li>ゲーム内の「ブラウザ」を操作して謎を解きます。</li>
                    <li><strong>検索エンジン（Googleなど）や外部ツールを使って情報を調べることもあります。</strong></li>
                </ul>
                <h3>⚠️ ご注意</h3>
                <p>本作には<strong>ホラー表現、ジャンプスケア（突然の驚かし要素）</strong>が含まれています。</p>
                <p>心臓の弱い方や、ホラーが苦手な方はご注意ください。</p>
            </div>
            <button id="close-mystery-help-btn" class="btn-gray" style="margin-top:20px;">閉じる</button>
        </div>
    </div>
    
    <!-- Connect Territory ゲーム用 -->
    <div id="territory-help-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content help-content">
            <h2>Connect Territory の遊び方</h2>
            <div class="help-scroll-area">
                <h3>🚩 ゲームの目的</h3>
                <p>最大4人のプレイヤーがリアルタイムでマスを塗り、制限時間内により多くの陣地を獲得したプレイヤーが勝利するバトルロワイヤルゲームです。</p>
                <h3>💬 参加方法（配信モード）</h3>
                <p>配信者がゲームを開始した後、コメント欄で<strong>「参加」</strong>と入力することで、先着順でプレイヤーとしてエントリーできます。</p>
                <h3>🗺️ 陣地の広げ方</h3>
                <p>塗りたいマスの番号（例: <strong>「123」</strong>）をコメントします。自分の陣地と<strong>隣接しているマス</strong>しか塗ることはできません。</p>
                <h3>💣 イベントマス</h3>
                <p>マップ上に出現する<strong>「？」</strong>マスを獲得すると、ボム（周囲を塗る）やクロス（十字に塗る）などの特殊効果がランダムで発動！一気に陣地を広げるチャンスです。</p>
            </div>
            <button id="close-territory-help-btn" class="btn-gray" style="margin-top:20px;">閉じる</button>
        </div>
    </div>

    <!-- Pixel Art ゲーム用 -->
    <div id="pixel-help-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content help-content">
            <h2>Streamer Pixel Art の遊び方</h2>
            <div class="help-scroll-area">
                <h3>🎨 ゲームの目的</h3>
                <p>真っ白なキャンバスにドット絵を描くゲームです。勝敗はありません。素敵な絵を完成させましょう！</p>
                
                <h3> solo Solo Play</h3>
                <ul>
                    <li><strong>色選択:</strong> 右のパレットをクリックして色を選びます。</li>
                    <li><strong>描画:</strong> マウスドラッグで自由に塗れます。</li>
                    <li><strong>キーボード操作:</strong> 矢印キーでカーソル移動、[Z]キーまたは[スペース]キーで塗ることができます。</li>
                    <li><strong>元に戻す:</strong> [Ctrl]+[Z]キーで直前の操作を取り消せます。</li>
                </ul>
                
                <h3>📡 Stream Mode</h3>
                <ul>
                    <li><strong>参加:</strong> コメントで「参加」と入力すると、自動でチームが決まります。</li>
                    <li><strong>色変更:</strong> 「赤」「青」「黒」など、右のパレットにある色名をコメントすると、自分のペンの色が変わります。</li>
                    <li><strong>描画:</strong> 塗りたいマスの番号（例: 「100」）をコメントします。自分のチームのキャンバスに色が塗られます。</li>
                </ul>
            </div>
            <button id="close-pixel-help-btn" class="btn-gray" style="margin-top:20px;">閉じる</button>
        </div>
    </div>

    <!-- 支援モーダル (共通) -->
    <div id="home-support-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content" style="text-align: center;">
            <h2>開発者を支援する</h2>
            <p>プレイしていただきありがとうございます！<br>ご支援いただけると今後の開発の励みになります。</p>
            <div class="support-links">
                <a href="https://ko-fi.com/dontokoi_games" target="_blank" class="support-link-btn">Ko-fi で支援</a>
            </div>
            <button id="close-home-support-btn" class="btn-gray" style="margin-top:20px;">閉じる</button>
        </div>
    </div>

    <footer class="site-footer">
        <div class="footer-links">
            <a href="terms.html">利用規約</a>
            <a href="privacy.html">プライバシーポリシー</a>
            <a href="contact.html">お問い合わせ</a>
        </div>
        <p>&copy; 2025 Dontokoi Games. All Rights Reserved.</p>
    </footer>

    <!-- ▼▼▼ スクリプト ▼▼▼ -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const mobileWarning = document.getElementById('mobile-warning-overlay');
            const closeBtn = document.getElementById('mobile-warning-close-btn');
            if (mobileWarning && closeBtn) {
                closeBtn.addEventListener('click', () => {
                    mobileWarning.style.display = 'none';
                });
            }
            // --- API設定モーダルの処理 ---
            const apiModal = document.getElementById('global-api-modal');
            const apiOpenBtn = document.getElementById('api-settings-btn');
            const apiSaveBtn = document.getElementById('save-api-btn');
            const apiCloseBtn = document.getElementById('close-api-btn');
            const apiInput = document.getElementById('global-api-key');
            const videoInput = document.getElementById('global-video-id');

            apiOpenBtn.addEventListener('click', (e) => {
                e.preventDefault();
                const savedKey = sessionStorage.getItem('youtube_api_key');
                const savedVideoId = sessionStorage.getItem('youtube_target_video_id');
                if (savedKey) apiInput.value = savedKey;
                if (savedVideoId) videoInput.value = savedVideoId;
                apiModal.style.display = 'flex';
            });

            apiSaveBtn.addEventListener('click', () => {
                const apiKey = apiInput.value.trim();
                let videoId = videoInput.value.trim();

                if (videoId.includes('v=')) {
                    videoId = videoId.split('v=')[1].split('&')[0];
                } else if (videoId.includes('youtu.be/')) {
                    videoId = videoId.split('youtu.be/')[1].split('?')[0];
                } else if (videoId.includes('youtube.com/live/')) {
                    videoId = videoId.split('/live/')[1].split('?')[0];
                }

                if (apiKey && videoId) {
                    sessionStorage.setItem('youtube_api_key', apiKey);
                    sessionStorage.setItem('youtube_target_video_id', videoId);
                    alert('設定を保存しました。\n各ゲームの配信モードが有効になります。');
                    apiModal.style.display = 'none';
                } else {
                    alert('APIキーとVideo IDの両方を入力してください。\n（設定を削除したい場合は、ブラウザを閉じてください）');
                }
            });

            apiCloseBtn.addEventListener('click', () => { apiModal.style.display = 'none'; });
            apiModal.addEventListener('click', (e) => { if (e.target === apiModal) apiModal.style.display = 'none'; });

            // ヘルプアコーディオン
            const helpToggleBtn = document.getElementById('toggle-help-btn');
            const helpContent = document.getElementById('api-help-content');
            if (helpToggleBtn) {
                helpToggleBtn.addEventListener('click', () => {
                    if (helpContent.style.display === 'none') {
                        helpContent.style.display = 'block';
                        helpToggleBtn.textContent = '🔽 閉じる';
                    } else {
                        helpContent.style.display = 'none';
                        helpToggleBtn.textContent = '💡 キーの取得方法を見る';
                    }
                });
            }

            // --- 各ゲームのモーダル処理 ---
            
            // 野球
            const helpModal = document.getElementById('home-help-modal');
            const helpBtn = document.getElementById('home-how-to-play-btn');
            const closeHelpBtn = document.getElementById('close-home-help-btn');
            if (helpBtn) {
                helpBtn.addEventListener('click', () => { helpModal.style.display = 'flex'; });
                closeHelpBtn.addEventListener('click', () => { helpModal.style.display = 'none'; });
                helpModal.addEventListener('click', (e) => { if (e.target === helpModal) helpModal.style.display = 'none'; });
            }

            // 世論調査
            const warHelpModal = document.getElementById('war-help-modal');
            const warHelpBtn = document.getElementById('war-how-to-play-btn');
            const closeWarHelpBtn = document.getElementById('close-war-help-btn');
            if (warHelpBtn) {
                warHelpBtn.addEventListener('click', () => { warHelpModal.style.display = 'flex'; });
                closeWarHelpBtn.addEventListener('click', () => { warHelpModal.style.display = 'none'; });
                warHelpModal.addEventListener('click', (e) => { if(e.target === warHelpModal) warHelpModal.style.display = 'none'; });
            }

            // クイズ
            const quizHelpModal = document.getElementById('quiz-help-modal');
            const quizHelpBtn = document.getElementById('quiz-how-to-play-btn');
            const closeQuizHelpBtn = document.getElementById('close-quiz-help-btn');
            if (quizHelpBtn) {
                quizHelpBtn.addEventListener('click', () => { quizHelpModal.style.display = 'flex'; });
                closeQuizHelpBtn.addEventListener('click', () => { quizHelpModal.style.display = 'none'; });
                quizHelpModal.addEventListener('click', (e) => { if(e.target === quizHelpModal) quizHelpModal.style.display = 'none'; });
            }
            
            // 漢字
            const kanjiHelpModal = document.getElementById('kanji-help-modal');
            const kanjiHelpBtn = document.getElementById('kanji-how-to-play-btn');
            const closeKanjiHelpBtn = document.getElementById('close-kanji-help-btn');
            if (kanjiHelpBtn) {
                kanjiHelpBtn.addEventListener('click', () => { kanjiHelpModal.style.display = 'flex'; });
                closeKanjiHelpBtn.addEventListener('click', () => { kanjiHelpModal.style.display = 'none'; });
                kanjiHelpModal.addEventListener('click', (e) => { if(e.target === kanjiHelpModal) kanjiHelpModal.style.display = 'none'; });
            }

            // ミステリー
            const mysteryHelpModal = document.getElementById('mystery-help-modal');
            const mysteryHelpBtn = document.getElementById('mystery-how-to-play-btn');
            const closeMysteryHelpBtn = document.getElementById('close-mystery-help-btn');
            if (mysteryHelpBtn) {
                mysteryHelpBtn.addEventListener('click', () => { mysteryHelpModal.style.display = 'flex'; });
                closeMysteryHelpBtn.addEventListener('click', () => { mysteryHelpModal.style.display = 'none'; });
                mysteryHelpModal.addEventListener('click', (e) => { if(e.target === mysteryHelpModal) mysteryHelpModal.style.display = 'none'; });
            }
            
            // Connect Territory
            const territoryHelpModal = document.getElementById('territory-help-modal');
            const territoryHelpBtn = document.getElementById('territory-how-to-play-btn');
            const closeTerritoryHelpBtn = document.getElementById('close-territory-help-btn');
            if (territoryHelpBtn) {
                territoryHelpBtn.addEventListener('click', () => { territoryHelpModal.style.display = 'flex'; });
                closeTerritoryHelpBtn.addEventListener('click', () => { territoryHelpModal.style.display = 'none'; });
                territoryHelpModal.addEventListener('click', (e) => { if(e.target === territoryHelpModal) territoryHelpModal.style.display = 'none'; });
            }

            // Pixel Art
            const pixelHelpModal = document.getElementById('pixel-help-modal');
            const pixelHelpBtn = document.getElementById('pixel-how-to-play-btn');
            const closePixelHelpBtn = document.getElementById('close-pixel-help-btn');
            if (pixelHelpBtn) {
                pixelHelpBtn.addEventListener('click', () => { pixelHelpModal.style.display = 'flex'; });
                closePixelHelpBtn.addEventListener('click', () => { pixelHelpModal.style.display = 'none'; });
                pixelHelpModal.addEventListener('click', (e) => { if(e.target === pixelHelpModal) pixelHelpModal.style.display = 'none'; });
            }

            // --- 共通支援モーダル ---
            const supportModal = document.getElementById('home-support-modal');
            // 全ての支援ボタンを取得してイベントを設定
            const supportBtns = document.querySelectorAll('#home-support-btn, #war-support-btn, #quiz-support-btn, #kanji-support-btn, #mystery-support-btn, #territory-support-btn');
            supportBtns.forEach(btn => {
                btn.addEventListener('click', () => { supportModal.style.display = 'flex'; });
            });
            const closeSupportBtn = document.getElementById('close-home-support-btn');
            if (closeSupportBtn) {
                closeSupportBtn.addEventListener('click', () => { supportModal.style.display = 'none'; });
                supportModal.addEventListener('click', (e) => { if (e.target === supportModal) supportModal.style.display = 'none'; });
            }
        });
    </script>

</body>
</html>