<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <!-- Google Analytics Control Script -->
    <script>
      (function() {
        var GA_ID = 'G-TS77Z86Q2V';
        var isLocal = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1' || window.location.hostname.startsWith('192.168.') || window.location.protocol === 'file:';
        var isAdmin = localStorage.getItem('analytics_ignore') === 'true';
        if (!isLocal && !isAdmin) {
          var script = document.createElement('script');
          script.async = true;
          script.src = 'https://www.googletagmanager.com/gtag/js?id=' + GA_ID;
          document.head.appendChild(script);
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', GA_ID);
        } else {
          console.log('Google Analytics blocked (Local or Admin)');
        }
      })();
    </script>
    <title>è¦–è´è€…å‚åŠ å‹ï¼šã¿ã‚“ãªã§ã‚²ãƒ¼ãƒ </title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&family=Orbitron:wght@700&display=swap">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <style>
        .game-selection {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 30px;
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
            padding-bottom: 40px;
        }
        #home-page {
            overflow-y: auto;
            min-height: calc(100vh - 100px);
            align-items: flex-start;
            padding-top: 40px;
        }
    </style>
</head>
<body>

    <div id="mobile-warning-overlay">
        <div class="mobile-warning-content">
            <h1>PCã§ã®ã”åˆ©ç”¨ã‚’æ¨å¥¨ã—ã¾ã™</h1>
            <p>
                ã“ã®ã‚µã‚¤ãƒˆã®ã‚²ãƒ¼ãƒ ã¯ã€PCã®å¤§ããªç”»é¢ã§ã®ãƒ—ãƒ¬ã‚¤ã‚’æƒ³å®šã—ã¦ä½œã‚‰ã‚Œã¦ã„ã¾ã™ã€‚<br>
                ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã§ã¯ã€ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆãŒå´©ã‚ŒãŸã‚Šã€æ­£ã—ãæ“ä½œã§ããªã„å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚
            </p>
            <button id="mobile-warning-close-btn">é–‰ã˜ã¦ç¶šã‘ã‚‹</button>
        </div>
    </div>

    <header class="site-header">
        <h1>è¦–è´è€…å‚åŠ å‹ï¼šã¿ã‚“ãªã§ã‚²ãƒ¼ãƒ </h1>
        <nav>
            <a href="index.html">ãƒ›ãƒ¼ãƒ </a>
            <a href="help.html">ã‚ˆãã‚ã‚‹è³ªå•</a>
            <a href="about.html">ã“ã®ã‚µã‚¤ãƒˆã«ã¤ã„ã¦</a>
            <button id="api-settings-btn" class="header-api-btn">
                <span class="icon">âš™ï¸</span> é…ä¿¡è€…ç”¨è¨­å®š
            </button>
        </nav>
    </header>

    <main id="home-page">

    <div class="feature-banners">
        <div class="feature-card">
            <picture>
                <source srcset="img/banner_news.webp" type="image/webp">
                <img src="img/banner_news.png" alt="ãŠçŸ¥ã‚‰ã›" width="640" height="360">
            </picture>
            <div class="feature-content">
                <h3>ğŸ“¢ ãŠçŸ¥ã‚‰ã›ãƒ»æ›´æ–°æƒ…å ±</h3>
                <a href="https://note.com/dontokoi_games/" target="_blank" class="feature-btn btn-gray">æœ€æ–°æƒ…å ±ã‚’è¦‹ã‚‹</a>
            </div>
        </div>
        <div class="feature-card">
            <picture>
                <source srcset="img/banner_newgame.webp" type="image/webp">
                <img src="img/banner_newgame.png" alt="æ–°ä½œã‚²ãƒ¼ãƒ " width="640" height="360">
            </picture>
            <div class="feature-content">
                <h3>âœ¨ æ–°ä½œã‚²ãƒ¼ãƒ ç™»å ´ï¼</h3>
                <a href="mystery/index.html" class="feature-btn" style="background-color: #6b46c1;">ä»Šã™ããƒ—ãƒ¬ã‚¤</a>
            </div>
        </div>
        <div class="feature-card">
            <picture>
                <source srcset="img/banner_guide.webp" type="image/webp">
                <img src="img/banner_guide.png" alt="åˆã‚ã¦ã®æ–¹ã¸" width="640" height="360" fetchpriority="high">
            </picture>
            <div class="feature-content">
                <h3>ğŸ”° åˆã‚ã¦ã®æ–¹ã¸</h3>
                <a href="guide.html" class="feature-btn btn-green">éŠã³æ–¹ã‚¬ã‚¤ãƒ‰ã‚’è¦‹ã‚‹</a>
            </div>
        </div>
    </div>

        <!-- è‡ªå‹•ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div class="ranking-section" id="ranking-section" style="display: none;">
            <h2 class="ranking-title">ğŸ† äººæ°—ã‚²ãƒ¼ãƒ ãƒ©ãƒ³ã‚­ãƒ³ã‚°</h2>
            <div class="ranking-tabs">
                <button class="rank-tab active" onclick="switchRanking('total', this)">å…¨æœŸé–“</button>
                <button class="rank-tab" onclick="switchRanking('yearly', this)">å¹´é–“</button>
                <button class="rank-tab" onclick="switchRanking('monthly', this)">æœˆé–“</button>
                <button class="rank-tab" onclick="switchRanking('weekly', this)">é€±é–“</button>
                <button class="rank-tab" onclick="switchRanking('daily', this)">ãƒ‡ã‚¤ãƒªãƒ¼</button>
            </div>
            <div class="ranking-slider-wrapper">
                <button class="slider-arrow prev" id="slider-prev" onclick="moveSlide(-1)">&#10094;</button>
                <div class="ranking-viewport">
                    <div class="ranking-track" id="ranking-track"></div>
                </div>
                <button class="slider-arrow next" id="slider-next" onclick="moveSlide(1)">&#10095;</button>
            </div>
            <div id="ranking-message-area" style="display:none;"></div>
        </div>

        <!-- é…ä¿¡ä¸­ãƒãƒ£ãƒ³ãƒãƒ«ãƒãƒŠãƒ¼ -->
        <div class="live-banner-container">
            <button id="open-live-list-btn" class="live-banner">
                <img src="img/chara_left.webp" class="banner-chara chara-left" alt="" width="200" height="250">
                <div class="live-content">
                    <span class="live-icon">ğŸ”´ LIVE</span>
                    <span class="live-text">ç¾åœ¨ <strong id="live-count">0</strong> åãŒé…ä¿¡ä¸­ï¼ é…ä¿¡ãƒªã‚¹ãƒˆã‚’è¦‹ã‚‹</span>
                </div>
                <img src="img/chara_right.webp" class="banner-chara chara-right" alt="">
                <span class="live-arrow">â–¶</span>
            </button>
        </div>

        <!-- é…ä¿¡ãƒªã‚¹ãƒˆãƒ¢ãƒ¼ãƒ€ãƒ« -->
        <div id="live-list-modal" class="modal-overlay" style="display: none;">
            <div class="modal-content live-modal-content">
                <h2>ğŸ”´ ç¾åœ¨é…ä¿¡ä¸­ã®ãƒãƒ£ãƒ³ãƒãƒ«</h2>
                <p style="font-size: 0.9em; color: #a0aec0; margin-bottom: 20px;">â€»ç™»éŒ²ã‹ã‚‰2æ™‚é–“ä»¥å†…ã®é…ä¿¡ã‚’è¡¨ç¤ºã—ã¦ã„ã¾ã™ã€‚</p>
                <div id="live-list-container" class="live-list-grid"><p>èª­ã¿è¾¼ã¿ä¸­...</p></div>
                <button id="close-live-list-btn" class="btn-gray" style="margin-top: 20px;">é–‰ã˜ã‚‹</button>
            </div>
        </div>

        <div class="game-selection" id="game-list">
            <!-- å„ã‚²ãƒ¼ãƒ ã‚«ãƒ¼ãƒ‰ (çœç•¥ã›ãšã«ãã®ã¾ã¾ä½¿ãˆã¾ã™) -->
            <div class="game-card">
                <h2>é«˜æ ¡é‡çƒã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</h2>
                <picture>
                    <source srcset="baseball/img/p_normal.webp" type="image/webp">
                    <img src="baseball/img/p_normal.png" alt="é«˜æ ¡é‡çƒã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³" width="110" height="110" class="game-thumbnail">
                </picture>
                <p>é«˜æ ¡çƒå…ã¨ã—ã¦3å¹´é–“ã‚’éã”ã—ã€ç”²å­åœ’ã‚’ç›®æŒ‡ãã†ï¼</p>
                <div class="mode-buttons">
                    <a href="baseball/index.html?mode=solo" class="game-link-btn btn-green">å€‹äººã§éŠã¶</a>
                    <a href="baseball/index.html?mode=streamer" class="game-link-btn btn-blue">é…ä¿¡ã§éŠã¶</a>
                    <button id="home-how-to-play-btn" class="game-link-btn btn-gray">éŠã³æ–¹ãƒ»æ©Ÿèƒ½èª¬æ˜</button>
                    <button id="home-support-btn" class="game-link-btn btn-pink">é–‹ç™ºè€…ã‚’æ”¯æ´ã™ã‚‹</button>
                </div>
            </div>
            <div class="game-card">
                <h2>è¦–è´è€…å‚åŠ å‹ä¸–è«–èª¿æŸ»</h2>
                <img src="war/thumbnail.webp" alt="é™£å–ã‚Šåˆæˆ¦" class="game-thumbnail" width="110" height="110">
                <p>ã‚³ãƒ¡ãƒ³ãƒˆæ•°ã§å‹¢åŠ›ã‚’æ‹¡å¤§ã›ã‚ˆï¼<br>è¦–è´è€…å‚åŠ å‹ã®é™£å–ã‚Šã‚²ãƒ¼ãƒ ã€‚</p>
                <div class="mode-buttons">
                    <a href="war/index.html?mode=demo" class="game-link-btn btn-green">ãƒ‡ãƒ¢ãƒ—ãƒ¬ã‚¤ï¼ˆå€‹äººï¼‰</a>
                    <a href="war/index.html?mode=stream" class="game-link-btn btn-blue">é…ä¿¡ã§éŠã¶</a>
                    <button id="war-how-to-play-btn" class="game-link-btn btn-gray">éŠã³æ–¹ãƒ»æ©Ÿèƒ½èª¬æ˜</button>
                    <button id="war-support-btn" class="game-link-btn btn-pink">é–‹ç™ºè€…ã‚’æ”¯æ´ã™ã‚‹</button>
                </div>
            </div>
            <div class="game-card">
                <h2>ã¿ã‚“ãªã§ã‚¯ã‚¤ã‚ºï¼</h2>
                <div class="thumbnail-placeholder" style="border-color: #f6ad55; color: #f6ad55;"><span style="font-size: 2em;">Q</span></div>
                <p>å…¨å•æ­£è§£ã‚’ç›®æŒ‡ã›ï¼<br>è¦–è´è€…ã®æŠ•ç¥¨ã§ç­”ãˆã‚’æ±ºã‚ã‚‹ã‚¯ã‚¤ã‚ºç•ªçµ„ã€‚</p>
                <div class="mode-buttons">
                    <a href="quiz/index.html?mode=solo" class="game-link-btn btn-green">å€‹äººã§éŠã¶</a>
                    <a href="quiz/index.html?mode=streamer" class="game-link-btn btn-blue">é…ä¿¡ã§éŠã¶</a>
                    <button id="quiz-how-to-play-btn" class="game-link-btn btn-gray">éŠã³æ–¹ãƒ»æ©Ÿèƒ½èª¬æ˜</button>
                    <button id="quiz-support-btn" class="game-link-btn btn-pink">é–‹ç™ºè€…ã‚’æ”¯æ´ã™ã‚‹</button>
                </div>
            </div>
            <div class="game-card">
                <h2>é›£èª­æ¼¢å­—ã‚¯ã‚¤ã‚º</h2>
                <div class="thumbnail-placeholder" style="border-color: #e53e3e; color: #e53e3e;"><span style="font-size: 2em;">æ¼¢</span></div>
                <p>èª­ã‚ãŸã‚‰å¤©æ‰ï¼ï¼Ÿ<br>è¦–è´è€…ã¨ä¸€ç·’ã«é›£èª­æ¼¢å­—ã«æŒ‘æˆ¦ã—ã‚ˆã†ã€‚</p>
                <div class="mode-buttons">
                    <a href="kanji/index.html?mode=solo" class="game-link-btn btn-green">å€‹äººã§éŠã¶</a>
                    <a href="kanji/index.html?mode=streamer" class="game-link-btn btn-blue">é…ä¿¡ã§éŠã¶</a>
                    <button id="kanji-how-to-play-btn" class="game-link-btn btn-gray">éŠã³æ–¹ãƒ»æ©Ÿèƒ½èª¬æ˜</button>
                    <button id="kanji-support-btn" class="game-link-btn btn-pink">é–‹ç™ºè€…ã‚’æ”¯æ´ã™ã‚‹</button>
                </div>
            </div>
            <div class="game-card">
                <h2>The Secret Site</h2>
                <div class="thumbnail-placeholder" style="border-color: #000; color: #fff; background: #222;"><span style="font-size: 2em; font-family: 'Courier New', monospace;">404</span></div>
                <p>æ·±å¤œ2æ™‚ã€ãã®ã‚µã‚¤ãƒˆã¯ç¾ã‚Œã‚‹ã€‚<br>éƒ½å¸‚ä¼èª¬ã®è¬ã‚’è§£ãæ˜ã‹ã›ã€‚</p>
                <div class="mode-buttons">
                    <a href="mystery/index.html" class="game-link-btn btn-purple" style="background-color: #6b46c1;">PLAY START</a>
                    <button id="mystery-how-to-play-btn" class="game-link-btn btn-gray">éŠã³æ–¹ãƒ»æ©Ÿèƒ½èª¬æ˜</button>
                    <button id="mystery-support-btn" class="game-link-btn btn-pink">é–‹ç™ºè€…ã‚’æ”¯æ´ã™ã‚‹</button>
                </div>
            </div>
            <div class="game-card">
                <h2>é…ä¿¡è€… VS è¦–è´è€… é™£å–ã‚²ãƒ¼ãƒ </h2>
                <div class="thumbnail-placeholder" style="border-color: #4299e1; color: #4299e1;"><span style="font-size: 2em;">ğŸŒ</span></div>
                <p>ã‚³ãƒ¡ãƒ³ãƒˆã§ãƒã‚¹ã‚’å¡—ã£ã¦é™£åœ°ã‚’åºƒã’ã‚ï¼<br>è¦–è´è€…å‚åŠ å‹ã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é™£å–ã‚Šåˆæˆ¦ã€‚</p>
                <div class="mode-buttons">
                    <a href="territory/index.html?mode=demo" class="game-link-btn btn-green">ãƒ‡ãƒ¢ãƒ—ãƒ¬ã‚¤ï¼ˆå€‹äººï¼‰</a>
                    <a href="territory/index.html?mode=stream" class="game-link-btn btn-blue">é…ä¿¡ã§éŠã¶</a>
                    <button id="territory-how-to-play-btn" class="game-link-btn btn-gray">éŠã³æ–¹ãƒ»æ©Ÿèƒ½èª¬æ˜</button>
                    <button id="territory-support-btn" class="game-link-btn btn-pink">é–‹ç™ºè€…ã‚’æ”¯æ´ã™ã‚‹</button>
                </div>
            </div>
            <div class="game-card">
                <h2>ãƒ”ã‚¯ã‚»ãƒ« ã‚¤ãƒ©ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼</h2>
                <div class="thumbnail-placeholder" style="border-color: #ff7675; color: #ff7675;"><span style="font-size: 2em;">ğŸ¨</span></div>
                <p>ã¿ã‚“ãªã§çµµã‚’æã“ã†ï¼<br>ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚’å½©ã‚‹ãŠçµµæãã‚²ãƒ¼ãƒ ã€‚</p>
                <div class="mode-buttons">
                    <a href="pixel/index.html?mode=solo" class="game-link-btn btn-green">å€‹äººã§éŠã¶</a>
                    <button class="game-link-btn btn-gray" disabled>é–‹ç™ºä¸­ã§ã™</button>
                    <button id="pixel-how-to-play-btn" class="game-link-btn btn-gray">éŠã³æ–¹</button>
                    <button class="game-link-btn btn-pink" onclick="document.getElementById('home-support-modal').style.display = 'flex'">é–‹ç™ºè€…ã‚’æ”¯æ´ã™ã‚‹</button>
                </div>
            </div>
            <div class="game-card">
                <h2>ã‚¢ãƒä½“é¨“ VSãƒãƒˆãƒ«</h2>
                <div class="thumbnail-placeholder" style="border-color: #a29bfe; color: #a29bfe;"><span style="font-size: 2em;">ğŸ‘€</span></div>
                <p>å¾ã€…ã«å¤‰åŒ–ã™ã‚‹çµµã‚’è¦‹ã¦ã€ã©ã“ãŒå¤‰ã‚ã£ãŸã‹å½“ã¦ã‚ˆã†ï¼<br>é…ä¿¡è€…ã¨è¦–è´è€…ã®è¦³å¯ŸåŠ›ãŒè©¦ã•ã‚Œã‚‹å¯¾æˆ¦å‹é–“é•ã„æ¢ã—ã€‚</p>
                <div class="mode-buttons">
                    <a href="aha/index.html?mode=solo" class="game-link-btn btn-green">å€‹äººã§éŠã¶</a>
                    <a href="aha/index.html?mode=streamer" class="game-link-btn btn-blue">é…ä¿¡ã§éŠã¶</a>
                    <button id="aha-how-to-play-btn" class="game-link-btn btn-gray">éŠã³æ–¹ãƒ»æ©Ÿèƒ½èª¬æ˜</button>
                    <button id="aha-support-btn" class="game-link-btn btn-pink">é–‹ç™ºè€…ã‚’æ”¯æ´ã™ã‚‹</button>
                </div>
            </div>
            <div class="game-card">
                <h2>Coming Soon</h2>
                <div class="thumbnail-placeholder" style="border-color: #718096; color: #718096; border-style: dashed;"><span style="font-size: 2em;">?</span></div>
                <p>æ–°ã—ã„ã‚²ãƒ¼ãƒ ã‚’æº–å‚™ä¸­ã§ã™ã€‚<br>æ¬¡å›ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã‚’ãŠæ¥½ã—ã¿ã«ï¼</p>
                <div class="mode-buttons"><button class="game-link-btn btn-gray" disabled>åˆ¶ä½œä¸­</button></div>
            </div>
            <div class="game-card">
                <h2>Coming Soon</h2>
                <div class="thumbnail-placeholder" style="border-color: #718096; color: #718096; border-style: dashed;"><span style="font-size: 2em;">?</span></div>
                <p>ã•ã‚‰ãªã‚‹æ–°ä½œã‚‚è¨ˆç”»ä¸­...<br>ç¶šå ±ã‚’ãŠå¾…ã¡ãã ã•ã„ã€‚</p>
                <div class="mode-buttons"><button class="game-link-btn btn-gray" disabled>æ§‹æƒ³ä¸­</button></div>
            </div>
        </div>
        <div id="pagination-controls" class="pagination-container"></div>
    </main>

    <!-- â–¼â–¼â–¼ é…ä¿¡è¨­å®šãƒ¢ãƒ¼ãƒ€ãƒ« (ä¿®æ­£æ¸ˆã¿) â–¼â–¼â–¼ -->
    <div id="global-api-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <h2>é…ä¿¡è¨­å®šï¼ˆAPI & Video IDï¼‰</h2>
            <div class="warning-box" style="border-color: #ecc94b; background-color: rgba(236, 201, 75, 0.15);">
                <h3 style="color: #ecc94b;">âš ï¸ é…ä¿¡é…å»¶è¨­å®šã«ã¤ã„ã¦</h3>
                <p style="font-size: 0.9em;">YouTube Liveã®ç®¡ç†ç”»é¢ã§<strong>ã€Œè¶…ä½é…å»¶ã€</strong>ã«è¨­å®šã™ã‚‹ã“ã¨ã‚’æ¨å¥¨ã—ã¾ã™ã€‚</p>
            </div>
            <p class="modal-desc">è¨­å®šã—ãŸå†…å®¹ã¯ãƒ–ãƒ©ã‚¦ã‚¶ã«ä¸€æ™‚ä¿å­˜ã•ã‚Œã¾ã™ã€‚</p>
            
            <div class="input-group">
                <label>YouTube API Key</label>
                <input type="password" id="global-api-key" placeholder="APIã‚­ãƒ¼ã‚’å…¥åŠ›" autocomplete="off">
            </div>
            <div class="input-group">
                <label>Video ID (ã¾ãŸã¯é…ä¿¡URL)</label>
                <input type="text" id="global-video-id" placeholder="ä¾‹: jNQXAC9IVRw ã¾ãŸã¯ URL" autocomplete="off">
                <p style="font-size: 0.8em; color: #a0aec0; margin-top: 5px;">â€»URLã‚’å…¥åŠ›ã—ãŸå ´åˆã€è‡ªå‹•ã§IDéƒ¨åˆ†ã‚’æŠ½å‡ºã—ã¾ã™ã€‚</p>
            </div>

            <!-- â˜…Twitchè¨­å®šã‚¨ãƒªã‚¢ -->
            <div class="input-group" style="margin-top: 20px; border-top: 1px dashed #4a5568; padding-top: 20px;">
                <h3 style="color: #a970ff;">Twitch è¨­å®š</h3>
                <label>Twitch ãƒãƒ£ãƒ³ãƒãƒ«ID (ãƒ¦ãƒ¼ã‚¶ãƒ¼ID)</label>
                <input type="text" id="global-twitch-id" placeholder="ä¾‹: shaka" autocomplete="off">
                <p style="font-size: 0.8em; color: #a0aec0; margin-top: 5px;">â€»Twitchã®URLã®æœ«å°¾ã§ã™ (twitch.tv/<strong>ã“ã“</strong>)</p>
            </div>

            <div style="text-align: left; margin-top: 15px;">
                <button id="toggle-help-btn" class="btn-gray" style="width: 100%; font-size: 0.9em; padding: 8px;">ğŸ’¡ ã‚­ãƒ¼ã®å–å¾—æ–¹æ³•ã‚’è¦‹ã‚‹</button>
                <div id="api-help-content" style="display: none; background: #222; padding: 15px; border-radius: 5px; margin-top: 10px; font-size: 0.85em; color: #ddd; line-height: 1.6;">
                    <a href="help.html" target="_blank" style="color:#63b3ed; text-decoration: underline;">ã‚ˆãã‚ã‚‹è³ªå• / ãƒ˜ãƒ«ãƒ—</a>
                </div>
            </div>
            
            <div style="margin-top: 20px; padding-top: 20px; border-top: 1px dashed #4a5568;">
                <h3 style="font-size: 1.1em; color: #ecc94b; margin-bottom: 10px;">ğŸ”´ é…ä¿¡ä¸­ãƒªã‚¹ãƒˆã«æ²è¼‰ã™ã‚‹</h3>
                <button id="register-stream-btn" class="btn-orange" style="width: 100%;">ğŸ“º ã“ã®é…ä¿¡ã‚’ãƒªã‚¹ãƒˆã«ç™»éŒ²ï¼</button>
                <p id="register-status" style="margin-top: 8px; font-size: 0.9em; min-height: 1.2em;"></p>
            </div>

            <div class="modal-buttons">
                <button id="save-api-btn" class="btn-green">è¨­å®šã‚’ä¿å­˜ã—ã¦é–‰ã˜ã‚‹</button>
                <button id="close-api-btn" class="btn-gray">é–‰ã˜ã‚‹</button>
            </div>
        </div>
    </div>

    <!-- å„ç¨®ãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆçœç•¥ã›ãšã«è¨˜è¿°ï¼‰ -->
    <div id="home-help-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content help-content">
            <h2>ã‚²ãƒ¼ãƒ ã®éŠã³æ–¹</h2>
            <button id="close-home-help-btn" class="btn-gray" style="margin-top:20px;">é–‰ã˜ã‚‹</button>
        </div>
    </div>
    <div id="war-help-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content help-content">
            <h2>è¦–è´è€…å‚åŠ å‹ä¸–è«–èª¿æŸ»ã®éŠã³æ–¹</h2>
            <button id="close-war-help-btn" class="btn-gray" style="margin-top:20px;">é–‰ã˜ã‚‹</button>
        </div>
    </div>
    <div id="quiz-help-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content help-content">
            <h2>ã‚¯ã‚¤ã‚ºã®éŠã³æ–¹</h2>
            <button id="close-quiz-help-btn" class="btn-gray" style="margin-top:20px;">é–‰ã˜ã‚‹</button>
        </div>
    </div>
    <div id="kanji-help-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content help-content">
            <h2>é›£èª­æ¼¢å­—ã‚¯ã‚¤ã‚ºã®éŠã³æ–¹</h2>
            <button id="close-kanji-help-btn" class="btn-gray" style="margin-top:20px;">é–‰ã˜ã‚‹</button>
        </div>
    </div>
    <div id="mystery-help-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content help-content">
            <h2>The Secret Site ã®éŠã³æ–¹</h2>
            <button id="close-mystery-help-btn" class="btn-gray" style="margin-top:20px;">é–‰ã˜ã‚‹</button>
        </div>
    </div>
    <div id="territory-help-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content help-content">
            <h2>é™£å–ã‚²ãƒ¼ãƒ  ã®éŠã³æ–¹</h2>
            <button id="close-territory-help-btn" class="btn-gray" style="margin-top:20px;">é–‰ã˜ã‚‹</button>
        </div>
    </div>
    <div id="pixel-help-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content help-content">
            <h2>Pixel Art ã®éŠã³æ–¹</h2>
            <button id="close-pixel-help-btn" class="btn-gray" style="margin-top:20px;">é–‰ã˜ã‚‹</button>
        </div>
    </div>
    <div id="aha-help-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content help-content">
            <h2>ã‚¢ãƒä½“é¨“ãƒãƒˆãƒ«ã®éŠã³æ–¹</h2>
            <button id="close-aha-help-btn" class="btn-gray" style="margin-top:20px;">é–‰ã˜ã‚‹</button>
        </div>
    </div>
    <div id="home-support-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content" style="text-align: center;">
            <h2>é–‹ç™ºè€…ã‚’æ”¯æ´ã™ã‚‹</h2>
            <div class="support-links"><a href="https://ko-fi.com/dontokoi_games" target="_blank" class="support-link-btn">Ko-fi ã§æ”¯æ´</a></div>
            <button id="close-home-support-btn" class="btn-gray" style="margin-top:20px;">é–‰ã˜ã‚‹</button>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-check-compat.js"></script>

    <script>
        // --- Firebaseè¨­å®š ---
        const firebaseConfig = {
            apiKey: "AIzaSyCw2YxffEV5JUVAqSRbYHTZ0_-Yd1Uf3gc",
            authDomain: "minnade-game.firebaseapp.com",
            projectId: "minnade-game",
            storageBucket: "minnade-game.firebasestorage.app",
            messagingSenderId: "659173248268",
            appId: "1:659173248268:web:770956559c38af62b80d29",
            measurementId: "G-LHW83ZHKRC"
        };
        firebase.initializeApp(firebaseConfig);
        const appCheck = firebase.appCheck();
        appCheck.activate('6Ldf8hwsAAAAAK35RN1edQfICYo_rQzxyPTuyVmB', true);
        const db = firebase.firestore();

        const gameData = {
            "baseball": { title: "é«˜æ ¡é‡çƒã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³", imgClass: "img", imgPath: "baseball/img/p_normal.webp", color: "#48bb78", buttons: [ { label: "å€‹äººã§éŠã¶", url: "baseball/index.html?mode=solo", class: "btn-green" }, { label: "é…ä¿¡ã§éŠã¶", url: "baseball/index.html?mode=streamer", class: "btn-blue" }, { label: "éŠã³æ–¹ãƒ»æ©Ÿèƒ½èª¬æ˜", modalId: "home-help-modal", class: "btn-gray" }, { label: "é–‹ç™ºè€…ã‚’æ”¯æ´ã™ã‚‹", modalId: "home-support-modal", class: "btn-pink" } ] },
            "war": { title: "è¦–è´è€…å‚åŠ å‹ä¸–è«–èª¿æŸ»", imgClass: "img", imgPath: "war/thumbnail.webp", color: "#e53e3e", buttons: [ { label: "ãƒ‡ãƒ¢ãƒ—ãƒ¬ã‚¤", url: "war/index.html?mode=demo", class: "btn-green" }, { label: "é…ä¿¡ã§éŠã¶", url: "war/index.html?mode=stream", class: "btn-blue" }, { label: "éŠã³æ–¹ãƒ»æ©Ÿèƒ½èª¬æ˜", modalId: "war-help-modal", class: "btn-gray" }, { label: "é–‹ç™ºè€…ã‚’æ”¯æ´ã™ã‚‹", modalId: "home-support-modal", class: "btn-pink" } ] },
            "quiz": { title: "ã¿ã‚“ãªã§ã‚¯ã‚¤ã‚ºï¼", imgClass: "icon", imgContent: "Q", color: "#f6ad55", buttons: [ { label: "å€‹äººã§éŠã¶", url: "quiz/index.html?mode=solo", class: "btn-green" }, { label: "é…ä¿¡ã§éŠã¶", url: "quiz/index.html?mode=streamer", class: "btn-blue" }, { label: "éŠã³æ–¹ãƒ»æ©Ÿèƒ½èª¬æ˜", modalId: "quiz-help-modal", class: "btn-gray" }, { label: "é–‹ç™ºè€…ã‚’æ”¯æ´ã™ã‚‹", modalId: "home-support-modal", class: "btn-pink" } ] },
            "kanji": { title: "é›£èª­æ¼¢å­—ã‚¯ã‚¤ã‚º", imgClass: "icon", imgContent: "æ¼¢", color: "#e53e3e", buttons: [ { label: "å€‹äººã§éŠã¶", url: "kanji/index.html?mode=solo", class: "btn-green" }, { label: "é…ä¿¡ã§éŠã¶", url: "kanji/index.html?mode=streamer", class: "btn-blue" }, { label: "éŠã³æ–¹ãƒ»æ©Ÿèƒ½èª¬æ˜", modalId: "kanji-help-modal", class: "btn-gray" }, { label: "é–‹ç™ºè€…ã‚’æ”¯æ´ã™ã‚‹", modalId: "home-support-modal", class: "btn-pink" } ] },
            "mystery": { title: "The Secret Site", imgClass: "icon", imgContent: "404", color: "#000000", buttons: [ { label: "PLAY START", url: "mystery/index.html", class: "btn-purple", style: "background-color: #6b46c1;" }, { label: "éŠã³æ–¹ãƒ»æ©Ÿèƒ½èª¬æ˜", modalId: "mystery-help-modal", class: "btn-gray" }, { label: "é–‹ç™ºè€…ã‚’æ”¯æ´ã™ã‚‹", modalId: "home-support-modal", class: "btn-pink" } ] },
            "territory": { title: "é…ä¿¡è€… VS è¦–è´è€… é™£å–ã‚²ãƒ¼ãƒ ", imgClass: "icon", imgContent: "ğŸŒ", color: "#4299e1", buttons: [ { label: "ãƒ‡ãƒ¢ãƒ—ãƒ¬ã‚¤", url: "territory/index.html?mode=demo", class: "btn-green" }, { label: "é…ä¿¡ã§éŠã¶", url: "territory/index.html?mode=stream", class: "btn-blue" }, { label: "éŠã³æ–¹ãƒ»æ©Ÿèƒ½èª¬æ˜", modalId: "territory-help-modal", class: "btn-gray" }, { label: "é–‹ç™ºè€…ã‚’æ”¯æ´ã™ã‚‹", modalId: "home-support-modal", class: "btn-pink" } ] },
            "pixel": { title: "ãƒ”ã‚¯ã‚»ãƒ« ã‚¤ãƒ©ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼", imgClass: "icon", imgContent: "ğŸ¨", color: "#ff7675", buttons: [ { label: "å€‹äººã§éŠã¶", url: "pixel/index.html?mode=solo", class: "btn-green" }, { label: "éŠã³æ–¹", modalId: "pixel-help-modal", class: "btn-gray" }, { label: "é–‹ç™ºè€…ã‚’æ”¯æ´ã™ã‚‹", modalId: "home-support-modal", class: "btn-pink" } ] },
            "aha": { title: "ã‚¢ãƒä½“é¨“ VSãƒãƒˆãƒ«", imgClass: "icon", imgContent: "ğŸ‘€", color: "#a29bfe", buttons: [ { label: "å€‹äººã§éŠã¶", url: "aha/index.html?mode=solo", class: "btn-green" }, { label: "é…ä¿¡ã§éŠã¶", url: "aha/index.html?mode=streamer", class: "btn-blue" }, { label: "éŠã³æ–¹ãƒ»æ©Ÿèƒ½èª¬æ˜", modalId: "aha-help-modal", class: "btn-gray" }, { label: "é–‹ç™ºè€…ã‚’æ”¯æ´ã™ã‚‹", modalId: "home-support-modal", class: "btn-pink" } ] }
        };

        // ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒ­ã‚¸ãƒƒã‚¯
        let currentSlide = 0;
        let maxSlides = 0;
        function getCardsPerSlide() { return window.innerWidth <= 768 ? 1 : 3; }

        window.switchRanking = function(period, btnElement) {
            document.querySelectorAll('.rank-tab').forEach(btn => btn.classList.remove('active'));
            if(btnElement) btnElement.classList.add('active');
            currentSlide = 0;
            updateSlidePosition();
            const dates = getDates();

            if (period === 'total') {
                db.collection('games').orderBy('count', 'desc').limit(15).get().then(snapshot => {
                    if (snapshot.empty) return;
                    let dataList = [];
                    snapshot.forEach(doc => dataList.push({ id: doc.id, count: doc.data().count }));
                    renderHTML(dataList);
                });
            } else {
                let docId = "";
                if (period === 'daily') docId = `daily_${dates.daily}`;
                else if (period === 'weekly') docId = `weekly_${dates.weekly}`;
                else if (period === 'monthly') docId = `monthly_${dates.monthly}`;
                else if (period === 'yearly') docId = `yearly_${dates.yearly}`;

                db.collection('ranking').doc(docId).get().then(doc => {
                    if (doc.exists) renderRankingFromMap(doc.data());
                });
            }
        };

        function renderRankingFromMap(dataMap) {
            let dataList = Object.keys(dataMap).map(key => ({ id: key, count: dataMap[key] }));
            dataList.sort((a, b) => b.count - a.count);
            renderHTML(dataList.slice(0, 15));
        }

        function renderHTML(dataList) {
            const track = document.getElementById('ranking-track');
            let html = "";
            let rank = 1;

            dataList.forEach(item => {
                const data = gameData[item.id];
                if (data) {
                    let imgHtml = data.imgClass === "img" ? `<img src="${data.imgPath}" class="ranking-img" width="60" height="60">` : `<div class="thumbnail-placeholder" style="border-color: ${data.color}; color: ${data.color};"><span style="font-size: 2em;">${data.imgContent}</span></div>`;
                    let rankClass = "rank-common";
                    let crownText = rank + "th";
                    if(rank === 1) { rankClass = "rank-1 rank-top"; crownText = "ğŸ‘‘ 1st"; }
                    if(rank === 2) { rankClass = "rank-2 rank-top"; crownText = "ğŸ¥ˆ 2nd"; }
                    if(rank === 3) { rankClass = "rank-3 rank-top"; crownText = "ğŸ¥‰ 3rd"; }

                    let buttonsHtml = '<div class="mode-buttons">';
                    data.buttons.forEach(btn => {
                        if (btn.url) buttonsHtml += `<a href="${btn.url}" class="game-link-btn ${btn.class}" onclick="handleGameClick(event, '${item.id}', '${btn.url}');">${btn.label}</a>`;
                        else if (btn.modalId) buttonsHtml += `<button class="game-link-btn ${btn.class}" onclick="openModal('${btn.modalId}')">${btn.label}</button>`;
                    });
                    buttonsHtml += '</div>';

                    html += `<div class="ranking-card ${rankClass}"><div class="crown">${crownText}</div><h3>${data.title}</h3><div class="thumbnail-wrapper">${imgHtml}</div><p style="font-size:0.8em; color:#a0aec0; margin-bottom:5px;">ãƒ—ãƒ¬ã‚¤å›æ•°: ${item.count}å›</p>${buttonsHtml}</div>`;
                    rank++;
                }
            });

            track.innerHTML = html;
            document.getElementById('ranking-section').style.display = "block";
            const cardsPerPage = getCardsPerSlide();
            maxSlides = Math.ceil(dataList.length / cardsPerPage) - 1;
            if (maxSlides < 0) maxSlides = 0;
            updateArrows();
        }

        window.moveSlide = function(direction) {
            currentSlide += direction;
            if (currentSlide < 0) currentSlide = 0;
            if (currentSlide > maxSlides) currentSlide = maxSlides;
            updateSlidePosition();
            updateArrows();
        };

        function updateSlidePosition() {
            const track = document.getElementById('ranking-track');
            const cardWidth = 220; const gap = 15; const cardsPerPage = getCardsPerSlide();
            const moveAmount = (cardWidth + gap) * cardsPerPage * currentSlide;
            track.style.transform = `translateX(-${moveAmount}px)`;
        }

        function updateArrows() {
            document.getElementById('slider-prev').disabled = (currentSlide === 0);
            document.getElementById('slider-next').disabled = (currentSlide === maxSlides);
        }

        function getDates() {
            const now = new Date();
            const y = now.getFullYear(); const m = String(now.getMonth() + 1).padStart(2, '0'); const d = String(now.getDate()).padStart(2, '0');
            const date = new Date(Date.UTC(now.getFullYear(), now.getMonth(), now.getDate()));
            date.setUTCDate(date.getUTCDate() + 4 - (date.getUTCDay()||7));
            const yearStart = new Date(Date.UTC(date.getUTCFullYear(),0,1));
            const weekNo = Math.ceil(( ( (date - yearStart) / 86400000) + 1)/7);
            return { daily: `${y}-${m}-${d}`, weekly: `${y}-W${weekNo}`, monthly: `${y}-${m}`, yearly: `${y}` };
        }

        window.handleGameClick = function(event, gameId, url) {
            event.preventDefault();
            const batch = db.batch();
            const totalRef = db.collection('games').doc(gameId);
            batch.set(totalRef, { count: firebase.firestore.FieldValue.increment(1) }, { merge: true });
            batch.commit().then(() => { window.location.href = url; });
        };

        window.openModal = function(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) modal.style.display = 'flex';
        };

        document.addEventListener('DOMContentLoaded', () => {
            switchRanking('total');

            const apiModal = document.getElementById('global-api-modal');
            const apiOpenBtn = document.getElementById('api-settings-btn');
            const apiSaveBtn = document.getElementById('save-api-btn');
            const apiCloseBtn = document.getElementById('close-api-btn');
            const apiInput = document.getElementById('global-api-key');
            const videoInput = document.getElementById('global-video-id');

            apiOpenBtn.addEventListener('click', () => { 
                const k = sessionStorage.getItem('youtube_api_key'); 
                const v = sessionStorage.getItem('youtube_target_video_id'); 
                const t = sessionStorage.getItem('twitch_channel_id');
                if (k) apiInput.value = k; 
                if (v) videoInput.value = v; 
                if (t) document.getElementById('global-twitch-id').value = t;
                apiModal.style.display = 'flex'; 
            });

            apiSaveBtn.addEventListener('click', () => { 
                const k = apiInput.value.trim(); 
                let v = videoInput.value.trim();
                
                const twitchInput = document.getElementById('global-twitch-id');
                const t = twitchInput ? twitchInput.value.trim() : "";

                // YouTube URLè§£æ
                try {
                    if (v.startsWith('http')) {
                        const url = new URL(v);
                        if (url.searchParams.has('v')) v = url.searchParams.get('v');
                        else if (url.pathname.includes('/live/')) v = url.pathname.split('/live/')[1];
                        else if (url.hostname === 'youtu.be') v = url.pathname.slice(1);
                    }
                    v = v.split('?')[0];
                } catch (e) {}

                if ((k && v) || t) { 
                    sessionStorage.setItem('youtube_api_key', k); 
                    sessionStorage.setItem('youtube_target_video_id', v); 
                    if (t) sessionStorage.setItem('twitch_channel_id', t);

                    alert('è¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸã€‚'); 
                    apiModal.style.display = 'none'; 
                } else { 
                    alert('YouTubeè¨­å®š ã¾ãŸã¯ Twitch IDã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚'); 
                }
            });
            
            apiCloseBtn.addEventListener('click', () => { apiModal.style.display = 'none'; });
            
            // ãƒ¢ãƒ¼ãƒ€ãƒ«ã®è¨­å®š
            const modalIds = [
                { btn: 'home-how-to-play-btn', modal: 'home-help-modal', close: 'close-home-help-btn' },
                { btn: 'war-how-to-play-btn', modal: 'war-help-modal', close: 'close-war-help-btn' },
                { btn: 'quiz-how-to-play-btn', modal: 'quiz-help-modal', close: 'close-quiz-help-btn' },
                { btn: 'kanji-how-to-play-btn', modal: 'kanji-help-modal', close: 'close-kanji-help-btn' },
                { btn: 'mystery-how-to-play-btn', modal: 'mystery-help-modal', close: 'close-mystery-help-btn' },
                { btn: 'territory-how-to-play-btn', modal: 'territory-help-modal', close: 'close-territory-help-btn' },
                { btn: 'pixel-how-to-play-btn', modal: 'pixel-help-modal', close: 'close-pixel-help-btn' },
                { btn: 'aha-how-to-play-btn', modal: 'aha-help-modal', close: 'close-aha-help-btn' }
            ];
            modalIds.forEach(item => {
                const btn = document.getElementById(item.btn);
                const modal = document.getElementById(item.modal);
                const close = document.getElementById(item.close);
                if(btn && modal && close) {
                    btn.addEventListener('click', () => modal.style.display = 'flex');
                    close.addEventListener('click', () => modal.style.display = 'none');
                    modal.addEventListener('click', (e) => { if(e.target === modal) modal.style.display = 'none'; });
                }
            });
            
            // æ”¯æ´ãƒ¢ãƒ¼ãƒ€ãƒ«
            const supportBtns = document.querySelectorAll('#home-support-btn, #war-support-btn, #quiz-support-btn, #kanji-support-btn, #mystery-support-btn, #territory-support-btn, #aha-support-btn');
            const supportModal = document.getElementById('home-support-modal');
            supportBtns.forEach(btn => { btn.addEventListener('click', () => { supportModal.style.display = 'flex'; }); });
            document.getElementById('close-home-support-btn').addEventListener('click', () => supportModal.style.display = 'none');

            // ãƒªãƒ³ã‚¯ãƒœã‚¿ãƒ³ã®ã‚«ã‚¦ãƒ³ãƒˆå‡¦ç†
            document.querySelectorAll('.game-link-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const href = btn.getAttribute('href');
                    if (href && !href.startsWith('javascript')) {
                        e.preventDefault();
                        // URLã‹ã‚‰ã‚²ãƒ¼ãƒ IDã‚’æ¨æ¸¬
                        let gameId = href.split('/')[0]; 
                        handleGameClick(e, gameId, href);
                    }
                });
            });

            // XSSå¯¾ç­–
            function escapeHtml(str) {
                if(!str) return "";
                return str.replace(/[&<>"']/g, function(m) {
                    return { '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#039;' }[m];
                });
            }
            
            // ãƒ©ã‚¤ãƒ–ãƒªã‚¹ãƒˆå–å¾—
            function loadStreams() {
                const listContainer = document.getElementById('live-list-container');
                const countSpan = document.getElementById('live-count');
                const now = new Date().getTime();
                const EXPIRE_MS = 2 * 60 * 60 * 1000;

                db.collection('streams').orderBy('createdAt', 'desc').limit(20).get().then(snapshot => {
                    let html = "";
                    let validCount = 0;
                    snapshot.forEach(doc => {
                        const data = doc.data();
                        if (now - data.createdAt.toMillis() < EXPIRE_MS) {
                            validCount++;
                            html += `<div class="stream-card"><a href="https://www.youtube.com/watch?v=${data.videoId}" target="_blank" class="stream-thumb-link"><img src="${data.thumbnail}" class="stream-thumb"></a><div class="stream-info"><div class="stream-title">${escapeHtml(data.title)}</div><div class="stream-channel">ğŸ“º ${escapeHtml(data.channelTitle)}</div><a href="https://www.youtube.com/watch?v=${data.videoId}" target="_blank" class="watch-btn">è¦–è´ã™ã‚‹</a></div></div>`;
                        }
                    });
                    if(countSpan) countSpan.textContent = validCount;
                    if(listContainer) listContainer.innerHTML = html || '<p>ç¾åœ¨é…ä¿¡ä¸­ã®ãƒãƒ£ãƒ³ãƒãƒ«ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>';
                });
            }
            
            document.getElementById('open-live-list-btn')?.addEventListener('click', () => { loadStreams(); document.getElementById('live-list-modal').style.display = 'flex'; });
            document.getElementById('close-live-list-btn')?.addEventListener('click', () => { document.getElementById('live-list-modal').style.display = 'none'; });

            loadStreams();
        });
    </script>

</body>
</html>