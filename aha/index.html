<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Google Analytics Control Script (ç§»æ¤) -->
    <script>
      (function() {
        var GA_ID = 'G-TS77Z86Q2V';
        var isLocal = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1' || window.location.hostname.startsWith('192.168.') || window.location.protocol === 'file:';
        var isAdmin = localStorage.getItem('analytics_ignore') === 'true';
        if (!isLocal && !isAdmin) {
          var script = document.createElement('script');
          script.async = true;
          script.src = 'https://www.googletagmanager.com/gtag/js?id=' + GA_ID;
          document.head.appendChild(script);
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', GA_ID);
        } else {
          console.log('Google Analytics blocked (Local or Admin)');
        }
      })();
    </script>
    
    <title>ã‚¢ãƒä½“é¨“ãƒãƒˆãƒ«</title>
    <link rel="icon" href="../favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@700&family=Orbitron:wght@700&display=swap">
</head>
<body>

    <!-- â–¼â–¼â–¼ è¨­å®šãƒ¢ãƒ¼ãƒ€ãƒ« â–¼â–¼â–¼ -->
    <div id="setup-modal" class="modal-overlay">
        <div class="modal-content">

            <!-- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ç”»é¢ -->
            <div id="loading-overlay" class="modal-loading-overlay hidden">
                <div class="spinner"></div>
                <p>ç”»åƒã‚’æº–å‚™ä¸­ã§ã™...</p>
            </div>

            <h2>GAME SETTINGS</h2>

            <p style="font-size: 0.85em; color: #a0aec0; margin-bottom: 20px;">
                â€»æœ¬ã‚²ãƒ¼ãƒ ã®ç”»åƒã¯ <strong>nano banana</strong> ã§ä½œæˆã—ãŸAIç”»åƒã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚
            </p>

            <!-- é…ä¿¡ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ é¸æŠ -->
            <div class="setup-group" id="platform-setting-group">
                <label>é…ä¿¡ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ </label>
                <div class="btn-group" id="platform-select">
                    <button class="setup-btn selected" data-val="youtube">YouTube</button>
                    <button class="setup-btn" data-val="twitch" style="color:#a970ff; border-color:#a970ff;">Twitch</button>
                </div>
            </div>
            
            <!-- åŠ¹æœéŸ³è¨­å®š -->
            <div class="setup-group">
                <label>Sound Effect</label>
                <div class="btn-group" id="sound-select">
                    <button class="setup-btn selected" data-val="on">ON</button>
                    <button class="setup-btn" data-val="off">OFF</button>
                </div>
            </div>

            <div class="setup-group">
                <label>å•é¡Œæ•°</label>
                <div class="btn-group" id="questions-select">
                    <button class="setup-btn" data-val="3">3å•</button>
                    <button class="setup-btn selected" data-val="5">5å•</button>
                    <button class="setup-btn" data-val="7">7å•</button>
                </div>
            </div>

            <div class="setup-group">
                <label>æŠ•ç¥¨æ™‚é–“ï¼ˆã‚·ãƒ³ã‚­ãƒ³ã‚°ã‚¿ã‚¤ãƒ ï¼‰</label>
                <div class="btn-group" id="time-select">
                    <button class="setup-btn" data-val="20">20ç§’</button>
                    <button class="setup-btn selected" data-val="25">25ç§’</button>
                    <button class="setup-btn" data-val="30">30ç§’</button>
                </div>
            </div>
            
            <div class="setup-footer">
                <a href="../index.html" class="back-link">ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹</a>
                <button id="setup-done-btn" class="action-btn">æ¬¡ã¸</button>
            </div>
        </div>
    </div>

    <!-- â–¼â–¼â–¼ å¾…æ©Ÿç”»é¢ï¼ˆREADYï¼‰ â–¼â–¼â–¼ -->
    <div id="ready-screen" class="modal-overlay hidden">
        <div class="modal-content" style="border-color: #63b3ed; box-shadow: 0 0 30px rgba(99, 179, 237, 0.3);">
            <h2 style="color: #63b3ed; font-size: 2.5em; font-family: 'Orbitron', sans-serif;">READY?</h2>
            <p style="color: #cbd5e0;">ã‚¢ãƒä½“é¨“ãƒãƒˆãƒ«ã‚’é–‹å§‹ã—ã¾ã™ã€‚</p>
            <button id="game-start-btn" class="action-btn" style="font-size: 1.5em; margin-top: 20px; background-color: #3182ce;">START</button>
            <div style="margin-top:15px;">
                <button id="back-to-setup-btn" style="background:transparent; border:none; color:#718096; cursor:pointer; text-decoration:underline;">è¨­å®šã«æˆ»ã‚‹</button>
            </div>
        </div>
    </div>

    <!-- â–¼â–¼â–¼ ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³æ¼”å‡º â–¼â–¼â–¼ -->
    <div id="countdown-overlay" class="modal-overlay hidden" style="background: transparent; pointer-events: none;">
        <div id="countdown-text" class="anim-text">3</div>
    </div>

    <!-- â–¼â–¼â–¼ å•é¡Œåˆ‡ã‚Šæ›¿ãˆãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³ â–¼â–¼â–¼ -->
    <div id="transition-layer" class="transition-layer hidden">
        <div class="transition-bg"></div>
        <div id="transition-text" class="transition-text">QUESTION 1</div>
    </div>
    
    <!-- â–¼â–¼â–¼ çµæœãƒ¢ãƒ¼ãƒ€ãƒ« â–¼â–¼â–¼ -->
    <div id="result-modal" class="modal-overlay hidden">
        <div class="modal-content result-content-wide">
            <!-- ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆèª¿æ•´ç”¨ã‚³ãƒ³ãƒ†ãƒŠ -->
            <div class="result-layout">
                <!-- å·¦å´ï¼šç”»åƒã‚¨ãƒªã‚¢ -->
                <div class="result-image-section">
                    <p class="result-img-caption">LAST STAGE</p>
                    <img id="result-last-image" src="" alt="Last Stage Image">
                </div>

                <!-- å³å´ï¼šã‚¹ã‚³ã‚¢ãƒ»æƒ…å ±ã‚¨ãƒªã‚¢ -->
                <div class="result-info-section">
                    <h2 id="result-title">GAME OVER</h2>
                    <p id="result-message"></p>
                    <div class="final-scores">
                        <div class="score-box host">é…ä¿¡è€…: <span id="final-host-score">0</span>ç‚¹</div>
                        <div class="score-box viewer">è¦–è´è€…: <span id="final-viewer-score">0</span>ç‚¹</div>
                    </div>
                    <button onclick="location.reload()" class="action-btn">ã‚‚ã†ä¸€åº¦ãƒ—ãƒ¬ã‚¤</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ãƒ¡ã‚¤ãƒ³ã®ã‚²ãƒ¼ãƒ ç”»é¢ -->
    <div id="game-container" class="hidden">
        <header>
            <div class="score-box host">é…ä¿¡è€…: <span id="host-score">0</span>ç‚¹</div>
            <div class="timer">TIME: <span id="timer">--</span></div>
            <div class="score-box viewer">è¦–è´è€…: <span id="viewer-score">0</span>ç‚¹</div>
        </header>

        <main id="image-area">
            <img id="base-image" src="" alt="å…ƒã®ç”»åƒ" width="1280" height="720" fetchpriority="high">
            <img id="changed-image" src="" alt="å¤‰åŒ–å¾Œã®ç”»åƒ" width="1280" height="720" fetchpriority="high">
            <div id="change-timer-box" class="change-timer-box hidden">
                <span style="font-size: 0.6em; color: #a0aec0; margin-right: 5px;">CHANGE</span>
                <span id="change-timer-val">0.0</span><span style="font-size: 0.8em;">s</span>
            </div>
            <div id="question-overlay" class="hidden">
                <h2>ã©ã“ãŒå¤‰ã‚ã£ãŸï¼Ÿ</h2>
            </div>
        </main>

        <footer>
            <div id="options-container" class="hidden">
                
                <!-- é…ä¿¡è€…ã‚¨ãƒªã‚¢ï¼ˆå·¦ï¼‰ -->
                <div class="options-wrapper host-wrapper">
                    <div class="column-header">
                        <span class="role-icon">ğŸ‘¤</span> é…ä¿¡è€…ã®å›ç­”
                    </div>
                    <div id="host-options" class="options-column"></div>
                </div>

                <!-- è¦–è´è€…ã‚¨ãƒªã‚¢ï¼ˆå³ï¼‰ -->
                <div class="options-wrapper viewer-wrapper">
                    <div class="column-header">
                        <span class="role-icon">ğŸ’¬</span> è¦–è´è€…ã®æŠ•ç¥¨
                    </div>
                    <div class="viewer-instruction">
                        ã‚³ãƒ¡ãƒ³ãƒˆã§ <strong>A</strong> <strong>B</strong> <strong>C</strong> <strong>D</strong> ã‚’å…¥åŠ›ï¼
                        <span style="font-size: 0.85em; opacity: 0.8;">(å°æ–‡å­— a b c d ã§ã‚‚OK)</span>
                    </div>
                    <div id="viewer-options" class="options-column"></div>
                </div>

            </div>

            <div id="voting-status" class="hidden">
                <p>è¦–è´è€…ã®æŠ•ç¥¨ã‚’å—ä»˜ä¸­... (è¨ˆ: <span id="vote-total">0</span>ç¥¨)</p>
            </div>
        </footer>
    </div>
    
    <!-- â˜…â˜…â˜… ä¿®æ­£æ¸ˆã¿ã®æ­£ã—ã„ä½ç½® â˜…â˜…â˜… -->
    <!-- ã“ã‚Œã«ã‚ˆã‚Šã€tmi.jsãŒç¢ºå®Ÿã«å…ˆã«èª­ã¿è¾¼ã¾ã‚Œã¾ã™ -->

    <script type="module" src="stages.js"></script>
    <script type="module" src="script.js"></script>
</body>
</html>