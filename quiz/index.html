<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
<!-- Google Analytics Control Script -->
<script>
  (function() {
    var GA_ID = 'G-TS77Z86Q2V';

    // 1. ローカル環境かどうか判定
    var isLocal = window.location.hostname === 'localhost' || 
                  window.location.hostname === '127.0.0.1' || 
                  window.location.hostname.startsWith('192.168.') ||
                  window.location.protocol === 'file:';

    var isAdmin = localStorage.getItem('analytics_ignore') === 'true';

    // ローカルでも管理者でもない場合のみGAを読み込む
    if (!isLocal && !isAdmin) {
      var script = document.createElement('script');
      script.async = true;
      script.src = 'https://www.googletagmanager.com/gtag/js?id=' + GA_ID;
      document.head.appendChild(script);

      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', GA_ID);
    } else {
      console.log('Google Analytics blocked (Local or Admin)');
    }
  })();
</script>
    <title>みんなでクイズ</title>
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@500;700&display=swap">
</head>
<body>

    <!-- 設定モーダル -->
    <div id="setup-modal" class="modal-overlay">
        <div class="modal-content">
            <h2>GAME SETTINGS</h2>
            
            <div class="setup-group">
                <label>難易度</label>
                <div class="btn-group" id="diff-select">
                    <button class="setup-btn" data-val="1">かんたん</button>
                    <button class="setup-btn selected" data-val="2">普通</button>
                    <button class="setup-btn" data-val="3">難しい</button>
                    <button class="setup-btn" data-val="4" style="color:#e74c3c;">東大王</button>
                </div>
            </div>

            <div class="setup-group">
                <label>ライフ (許容ミス数)</label>
                <div class="btn-group" id="life-select">
                    <button class="setup-btn" data-val="1">1回</button>
                    <button class="setup-btn selected" data-val="3">3回</button>
                    <button class="setup-btn" data-val="5">5回</button>
                </div>
            </div>

            <div class="setup-group">
                <label>目標問題数</label>
                <div class="btn-group" id="goal-select">
                    <button class="setup-btn selected" data-val="10">10問</button>
                    <button class="setup-btn" data-val="30">30問</button>
                    <button class="setup-btn" data-val="50">50問</button>
                </div>
            </div>

            <div class="setup-group">
                <label>投票時間（秒）</label>
                <div class="btn-group" id="time-select">
                    <button class="setup-btn" data-val="15">15秒</button>
                    <button class="setup-btn selected" data-val="30">30秒</button>
                    <button class="setup-btn" data-val="60">60秒</button>
                </div>
            </div>

            <div style="margin-top: 30px; display: flex; gap: 10px;">
                <button id="back-btn" class="action-btn secondary">ホームへ</button>
                <button id="setup-done-btn" class="action-btn primary">OK</button>
            </div>
        </div>
    </div>

    <!-- 待機画面 (Ready?) -->
    <div id="ready-screen" class="modal-overlay hidden" style="background: rgba(0,0,0,0.9);">
        <div class="modal-content" style="border-color: #f77f00; box-shadow: 0 0 30px #f77f00;">
            <h2 style="color: #f77f00; font-size: 2.5em;">ARE YOU READY?</h2>
            <p style="color: #fff;">心の準備はいいですか？</p>
            <button id="game-start-btn" class="action-btn primary" style="font-size: 1.5em; margin-top: 20px;">START</button>
            <div style="margin-top:15px;">
                <button id="back-to-setup-btn" style="background:transparent; border:none; color:#888; cursor:pointer; text-decoration:underline;">設定に戻る</button>
            </div>
        </div>
    </div>

    <!-- カウントダウンオーバーレイ -->
    <div id="countdown-overlay" class="modal-overlay hidden" style="background: transparent; pointer-events: none;">
        <div id="countdown-text">3</div>
    </div>

    <!-- ゲームメイン画面 -->
    <div id="game-container" class="hidden">
        <header>
            <div class="status-box">
                <span>Q. <span id="current-q-num">1</span> / <span id="total-q-num">10</span></span>
                <span style="margin-left: 20px; color: #e74c3c;">LIFE: <span id="life-display">❤️❤️❤️</span></span>
            </div>
            <div class="timer-box">
                TIME: <span id="timer">00</span>
            </div>
        </header>

        <div class="main-area">
            <!-- 問題文 -->
            <div class="question-box">
                <p id="question-text">問題文...</p>
            </div>

            <!-- 選択肢 -->
            <div class="options-grid" id="options-container">
                <button class="option-btn" id="btn-1"><span class="opt-label">1</span> <span class="opt-text">A</span><div class="vote-bar"></div></button>
                <button class="option-btn" id="btn-2"><span class="opt-label">2</span> <span class="opt-text">B</span><div class="vote-bar"></div></button>
                <button class="option-btn" id="btn-3"><span class="opt-label">3</span> <span class="opt-text">C</span><div class="vote-bar"></div></button>
                <button class="option-btn" id="btn-4"><span class="opt-label">4</span> <span class="opt-text">D</span><div class="vote-bar"></div></button>
            </div>
            
            <!-- 投票ステータス -->
            <div id="voting-status" class="hidden">
                投票受付中... (計: <span id="vote-count">0</span>票)
            </div>
        </div>
    </div>

    <!-- 結果モーダル -->
    <div id="result-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <h2 id="result-title">GAME OVER</h2>
            <p id="result-msg">残念...</p>
            <button onclick="location.reload()" class="action-btn primary">タイトルに戻る</button>
        </div>
    </div>

    <!-- SE読み込み (warと同じファイルがあれば流用、なければ適当な音源で) -->
    <!-- 今回は音源ファイルがない前提で、script.js内のAudio生成はコメントアウトまたは空実装にしておきます -->

    <script src="js/quiz-data.js"></script>
    <script src="js/script.js"></script>
</body>
</html>